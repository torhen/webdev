<!DOCTYPE html>
<html lang="en">
<head>
<title>ACE in Action</title>





</head>

<body>
<button onclick='run()'>Run</button>
<div id="edit_html" ></div>
<br>
<div id="edit_js" ></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.6/ace.js" type="text/javascript" charset="utf-8"></script>
/* jshint asi:true */
<script>

	class Editor{
		constructor(div_id, file_type,width, height){
			document.getElementById(div_id).style.width= width
			document.getElementById(div_id).style.height= height
			this._editor = ace.edit(div_id)
			//this._editor.setTheme("ace/theme/terminal")
			this._editor.session.setMode("ace/mode/" + file_type)
			this._editor.setOptions({fontSize: "10pt"})
		}
		
		loadFile(url){
			fetch(url)
				.then(x => x.text())
				.then(x => this._editor.setValue(x))
		}
		
		postText(url, para){
			var text = this._editor.getValue()
			var xhr = new XMLHttpRequest()

			xhr.open('POST', url)
			xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
			xhr.onload = function() {
					if (xhr.status === 200) {
						console.log(xhr.responseText)
					}
					else {
						alert('Request failed.  Returned status of ' + xhr.status);
					}
			}
			xhr.send(encodeURI('file=' + para + '&text=' + text));
			}
	
	}
	
	var edit_html = new Editor('edit_html', 'html', "100%", "500px")
	edit_html.loadFile('/app.html')
	
	var edit_js = new Editor('edit_js', 'javascript', "100%", "500px")
	edit_js.loadFile('/app.js')
	
	function run(){
		edit_html.postText('/change', 'app.html')
		edit_js.postText('/change', 'app.js')
		parent.location.reload()
	}

</script>
</body>
</html>